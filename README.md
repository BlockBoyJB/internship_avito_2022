# [Intership Avito 2022](https://github.com/avito-tech/internship_backend_2022)

## Микросервис для работы с балансом пользователей

Сделаны все основные задания + дополнительные (кроме тестов :/)

### Используемый стек

* **Golang 1.22**
* **Echo** основной веб фреймворк
* **Swagger** документация API
* **Redis** для кэширования баланса пользователя
* **PostgreSQL** как основная БД
* **Apache Kafka** для асинхронного взаимодействия с другими микросервисами
* **golang-migrate/migrate** для миграций основной бд


#### Помимо тестового задания были реализованы:

**Аутентификация**.  
Реализован минимальный метод аутентификации (jwt).
В тз ничего не сказано, но, скорее всего, подразумевается, что существует отдельный sso микросервис,
а разрабатываемый микросервис будет внутренним. 
Был выбран RS256 метод подписи ключа для заглушки сервиса аутентификации, поэтому токен просто валидируется и никак не используется
---

**Кэширование**  
Реализовано кэширование баланса пользователя в in-memory базе данных redis с целью увеличения скорости работы
---

**Брокер сообщений**  
Микросервис использует apache kafka для отправки сообщений в микросервис нотификаций (вымышленный). 
Т.е после каждого действия (пополнение, снятие, перевод, резервирование и т.д.) 
в брокер отправляется сообщение (id пользователя + сумма) с названием операции для дальнейшей обработки (например отправки уведомления пользователю)


### Вопросы по тестовому заданию

В процессе разработки микросервиса я столкнулся с рядом проблем/вопросов касательно некоторых моментов:  

**Создание аккаунта**  
Были сомнения, создавать новый id и возвращать его при создании или использовать внешний. 
Решил **_использовать внешний id_**, подразумевая, что у пользователя единый id на все микросервисы

**Метод признания выручки**
В тз было сказано, что метод на вход принимает id пользователя, id услуги, id заказа и сумму.
То есть подразумевается, что нужно удалить запись с резервированием денег. 
Однако в тз ничего не сказано касательно полей id услуги и id заказа. 
Было принято решение, что id заказа - не уникальное поле (в рамках одного заказа может быть несколько услуг, к тому же одинаковых),
а входные данные **_изменить на id записи с конкретным резервированием_**
